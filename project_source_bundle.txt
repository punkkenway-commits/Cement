
================================================================================
PROJECT OVERVIEW: CBL/VDL Intelligent Analyzer (Petroleum Engineering)
STACK: React 19, TypeScript, Tailwind CSS, Google GenAI SDK (@google/genai)
CONTEXT: 
This is a web application for Petroleum Engineers to analyze Cement Bond Logs (CBL/VDL).
It uploads a PDF, sends it to Gemini Pro Vision, and returns a detailed analysis.
The analysis must be segmented into 50-meter intervals and provide bilingual output (English/Arabic).
================================================================================

--- FILE: index.html ---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CBL/VDL Analyzer - Cementing Section</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Kufi+Arabic:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Inter', sans-serif; }
      .font-arabic { font-family: 'Noto Kufi Arabic', sans-serif; }
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #1f2937; }
      ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
    </style>
  </head>
  <body class="bg-gray-900 text-gray-100 antialiased">
    <div id="root"></div>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>

--- FILE: types.ts ---
export interface BondZone {
  depthFrom: number;
  depthTo: number;
  quality: 'Excellent' | 'Good' | 'Moderate' | 'Poor' | 'Free Pipe';
  descriptionEn: string;
  descriptionAr: string;
  reason?: string;
  reasonAr?: string;
}

export interface AnalysisResult {
  summaryEn: string;
  summaryAr: string;
  zones: BondZone[];
  recommendationsEn: string[];
  recommendationsAr: string[];
  logTypeDetected: string;
  depthUnit: 'Meters' | 'Feet';
}

export enum AnalysisStatus {
  IDLE = 'IDLE',
  UPLOADING = 'UPLOADING',
  ANALYZING = 'ANALYZING',
  COMPLETED = 'COMPLETED',
  ERROR = 'ERROR',
}

--- FILE: services/geminiService.ts ---
import { GoogleGenAI, Type, Schema } from "@google/genai";
import { AnalysisResult } from '../types';

const MODEL_NAME = 'gemini-3-pro-preview';

export const analyzeLogPDF = async (base64Pdf: string): Promise<AnalysisResult> => {
  // NOTE: Ensure process.env.API_KEY is handled in your deployment environment
  const apiKey = process.env.API_KEY; 
  if (!apiKey) throw new Error("API Key is missing");

  const ai = new GoogleGenAI({ apiKey });

  const schema: Schema = {
    type: Type.OBJECT,
    properties: {
      summaryEn: { type: Type.STRING },
      summaryAr: { type: Type.STRING },
      logTypeDetected: { type: Type.STRING },
      depthUnit: { type: Type.STRING, enum: ["Meters", "Feet"] },
      zones: {
        type: Type.ARRAY,
        description: "List of analyzed depth intervals. MUST be segmented into fixed 50-meter (or 165ft) steps.",
        items: {
          type: Type.OBJECT,
          properties: {
            depthFrom: { type: Type.NUMBER },
            depthTo: { type: Type.NUMBER },
            quality: { type: Type.STRING, enum: ['Excellent', 'Good', 'Moderate', 'Poor', 'Free Pipe'] },
            descriptionEn: { type: Type.STRING },
            descriptionAr: { type: Type.STRING },
            reason: { type: Type.STRING },
            reasonAr: { type: Type.STRING }
          },
          required: ["depthFrom", "depthTo", "quality", "descriptionEn", "descriptionAr"]
        }
      },
      recommendationsEn: { type: Type.ARRAY, items: { type: Type.STRING } },
      recommendationsAr: { type: Type.ARRAY, items: { type: Type.STRING } }
    },
    required: ["summaryEn", "summaryAr", "zones", "recommendationsEn", "recommendationsAr", "logTypeDetected", "depthUnit"]
  };

  const prompt = `
    You are a Senior Petroleum Engineer and specialist in the Well Cementing Section (ÿ¥ÿπÿ®ÿ© ÿ™ÿ≥ŸÖŸäÿ™ ÿßŸÑÿ¢ÿ®ÿßÿ±).
    Your task is to analyze the provided Cement Bond Log (CBL) and Variable Density Log (VDL) PDF.

    **STRICT ANALYSIS PROTOCOL - 50 METER INTERVALS:**
    1. **Segmentation:** You MUST divide the analyzed log section into fixed intervals of **50 meters** (e.g., 2000-2050m, 2050-2100m). If the log is in feet, use **165 feet** as the interval equivalent.
    2. **Interval Analysis:** For EACH 50m/165ft interval, you must provide:
       - **Bond Quality:** Overall rating (Excellent, Good, Moderate, Poor, Free Pipe).
       - **Description:** A detailed technical explanation of the cement condition in this specific interval. Mention specific depths of anomalies *within* the interval.
       - **Reason for Weakness:** If the bond is weak, analyze the VDL to diagnose the cause (e.g., Channeling/Wet Shoe, Micro-annulus, Fast Formation, Eccentricity, Gas Migration).
    
    **Language Requirements:**
    - The output must be bilingual (English & Arabic).
    - Use accurate **Iraqi/Technical Arabic** terminology for cementing (e.g., "Squeeze" -> "ÿ≠ŸÇŸÜ", "Bond" -> "ÿßÿµÿ±Ÿëÿ©/ÿ™ŸÑÿßÿ≠ŸÖ", "Casing" -> "ÿ®ÿ∑ÿßŸÜÿ©", "Micro-annulus" -> "ŸÅÿ±ÿßÿ∫ ÿ≠ŸÑŸÇŸä ÿ¥ÿπÿ±Ÿä", "Channeling" -> "ÿ™Ÿáÿ±Ÿäÿ®").
    - Explain *why* the bond is weak in the Arabic description clearly.

    **Technical Details to Look For:**
    - **CBL Amplitude:** Low amplitude = Good bond, High amplitude = Poor bond.
    - **VDL Waveforms:** 
      - Strong Casing Arrivals (Straight lines) = Free Pipe/Poor Bond.
      - Strong Formation Arrivals (Wavy lines) = Good Bond.
      - Weak Formation + Weak Casing = Moderate/Lightweight Cement.
  `;

  const response = await ai.models.generateContent({
    model: MODEL_NAME,
    contents: {
      parts: [
        { inlineData: { mimeType: "application/pdf", data: base64Pdf } },
        { text: prompt }
      ]
    },
    config: {
      responseMimeType: "application/json",
      responseSchema: schema,
      thinkingConfig: { thinkingBudget: 8192 }
    }
  });

  return JSON.parse(response.text!) as AnalysisResult;
};

--- FILE: components/FileUploader.tsx ---
import React, { useState, useRef } from 'react';
import { AnalysisStatus } from '../types';

interface FileUploaderProps {
  onFileSelect: (base64: string, fileName: string) => void;
  status: AnalysisStatus;
}

const FileUploader: React.FC<FileUploaderProps> = ({ onFileSelect, status }) => {
  const [dragActive, setDragActive] = useState(false);
  const inputRef = useRef<HTMLInputElement>(null);

  const handleDrag = (e: React.DragEvent) => {
    e.preventDefault(); e.stopPropagation();
    if (e.type === "dragenter" || e.type === "dragover") setDragActive(true);
    else if (e.type === "dragleave") setDragActive(false);
  };

  const processFile = (file: File) => {
    if (file && file.type === "application/pdf") {
      const reader = new FileReader();
      reader.onload = (e) => {
        const base64 = (e.target?.result as string).split(',')[1];
        onFileSelect(base64, file.name);
      };
      reader.readAsDataURL(file);
    } else { alert("Please upload a valid PDF file."); }
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault(); e.stopPropagation(); setDragActive(false);
    if (e.dataTransfer.files[0]) processFile(e.dataTransfer.files[0]);
  };

  const isProcessing = status === AnalysisStatus.UPLOADING || status === AnalysisStatus.ANALYZING;

  return (
    <div 
      className={`relative w-full p-8 border-2 border-dashed rounded-xl transition-all ${dragActive ? 'border-amber-500 bg-amber-500/10' : 'border-gray-600 bg-gray-800'}`}
      onDragEnter={handleDrag} onDragLeave={handleDrag} onDragOver={handleDrag} onDrop={handleDrop}
    >
      <input ref={inputRef} type="file" className="hidden" accept="application/pdf" onChange={(e) => e.target.files?.[0] && processFile(e.target.files[0])} />
      <div className="flex flex-col items-center text-center">
        <div className="p-4 bg-gray-700 rounded-full text-amber-500 mb-4">
           {/* Icon placeholder */}
           <span className="text-2xl">üìÑ</span>
        </div>
        <h3 className="text-lg font-semibold text-white">{isProcessing ? "Processing..." : "Upload CBL/VDL Log"}</h3>
        <button onClick={() => inputRef.current?.click()} disabled={isProcessing} className="mt-4 px-6 py-2 bg-amber-500 rounded-lg hover:bg-amber-400 text-gray-900 font-medium">Select File</button>
      </div>
    </div>
  );
};
export default FileUploader;

--- FILE: components/ResultView.tsx ---
import React, { useState } from 'react';
import { AnalysisResult } from '../types';

interface ResultViewProps { result: AnalysisResult; }

const ResultView: React.FC<ResultViewProps> = ({ result }) => {
  const [lang, setLang] = useState<'en' | 'ar'>('en');
  
  const getQualityColor = (q: string) => {
    if(q === 'Excellent') return 'text-green-400 border-green-400/30';
    if(q === 'Good') return 'text-emerald-400 border-emerald-400/30';
    if(q === 'Poor' || q === 'Free Pipe') return 'text-red-400 border-red-400/30';
    return 'text-yellow-400 border-yellow-400/30';
  };

  return (
    <div className="w-full max-w-6xl mx-auto space-y-8">
      <div className="flex justify-between items-center bg-gray-800 p-4 rounded-xl">
        <h2 className="text-xl font-bold text-white">Analysis Report ({result.logTypeDetected})</h2>
        <div className="flex bg-gray-700 rounded-lg p-1">
          <button onClick={() => setLang('en')} className={`px-4 py-1.5 rounded ${lang==='en'?'bg-amber-500 text-black':'text-gray-300'}`}>EN</button>
          <button onClick={() => setLang('ar')} className={`px-4 py-1.5 rounded font-arabic ${lang==='ar'?'bg-amber-500 text-black':'text-gray-300'}`}>ÿπÿ±ÿ®Ÿä</button>
        </div>
      </div>

      <div className="bg-gray-800 rounded-xl p-6 border border-gray-700">
        <h3 className={`text-lg font-semibold text-amber-400 mb-2 ${lang==='ar'?'text-right font-arabic':''}`}>{lang==='en'?'Summary':'ÿßŸÑÿÆŸÑÿßÿµÿ©'}</h3>
        <p className={`text-gray-200 ${lang==='ar'?'text-right font-arabic':''}`}>{lang==='en'?result.summaryEn:result.summaryAr}</p>
      </div>

      <div className="bg-gray-800 rounded-xl overflow-hidden border border-gray-700">
        <table className="w-full text-left" dir={lang==='ar'?'rtl':'ltr'}>
          <thead className="bg-gray-900/50 text-gray-400">
            <tr>
              <th className="p-4">{lang==='en'?'Depth':'ÿßŸÑÿπŸÖŸÇ'}</th>
              <th className="p-4">{lang==='en'?'Quality':'ÿßŸÑÿ¨ŸàÿØÿ©'}</th>
              <th className="p-4 w-1/3">{lang==='en'?'Description':'ÿßŸÑŸàÿµŸÅ'}</th>
              <th className="p-4">{lang==='en'?'Reason':'ÿßŸÑÿ≥ÿ®ÿ®'}</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-gray-700">
            {result.zones.map((zone, i) => (
              <tr key={i} className="hover:bg-gray-700/30">
                <td className="p-4 font-mono text-white">{zone.depthFrom}-{zone.depthTo}</td>
                <td className="p-4"><span className={`px-2 py-1 border rounded text-xs ${getQualityColor(zone.quality)}`}>{zone.quality}</span></td>
                <td className={`p-4 text-sm text-gray-300 ${lang==='ar'?'font-arabic':''}`}>{lang==='en'?zone.descriptionEn:zone.descriptionAr}</td>
                <td className={`p-4 text-sm text-amber-200/80 ${lang==='ar'?'font-arabic':''}`}>{lang==='en' ? (zone.reason||'-') : (zone.reasonAr||zone.reason||'-')}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
      
      <div className="bg-gray-800 rounded-xl p-6 border border-gray-700">
         <h3 className={`text-lg font-semibold text-white mb-4 ${lang==='ar'?'text-right font-arabic':''}`}>{lang==='en'?'Recommendations':'ÿßŸÑÿ™ŸàÿµŸäÿßÿ™'}</h3>
         <ul className={`space-y-2 ${lang==='ar'?'text-right font-arabic':''}`}>
           {(lang==='en'?result.recommendationsEn:result.recommendationsAr).map((r,i)=>(<li key={i} className="text-gray-300">‚Ä¢ {r}</li>))}
         </ul>
      </div>
    </div>
  );
};
export default ResultView;

--- FILE: App.tsx ---
import React, { useState } from 'react';
import FileUploader from './components/FileUploader';
import ResultView from './components/ResultView';
import { AnalysisResult, AnalysisStatus } from './types';
import { analyzeLogPDF } from './services/geminiService';

const App: React.FC = () => {
  const [status, setStatus] = useState<AnalysisStatus>(AnalysisStatus.IDLE);
  const [result, setResult] = useState<AnalysisResult | null>(null);

  const handleFile = async (base64: string) => {
    setStatus(AnalysisStatus.ANALYZING);
    try {
      const data = await analyzeLogPDF(base64);
      setResult(data);
      setStatus(AnalysisStatus.COMPLETED);
    } catch (e) { setStatus(AnalysisStatus.ERROR); }
  };

  return (
    <div className="min-h-screen bg-gray-900 text-gray-100 flex flex-col p-4">
      <header className="flex justify-between items-center py-4 mb-8 border-b border-gray-800">
        <h1 className="text-2xl font-bold text-amber-500">CementLog AI</h1>
        <span className="text-sm text-gray-500">Well Cementing Section</span>
      </header>
      <main className="flex-grow container mx-auto">
        {status === AnalysisStatus.IDLE && <FileUploader onFileSelect={handleFile} status={status} />}
        {status === AnalysisStatus.ANALYZING && <div className="text-center text-amber-500 mt-20">Analyzing CBL/VDL Log (50m Intervals)...</div>}
        {status === AnalysisStatus.ERROR && <div className="text-center text-red-500 mt-20">Analysis Failed. Please try again.</div>}
        {status === AnalysisStatus.COMPLETED && result && <ResultView result={result} />}
      </main>
    </div>
  );
};
export default App;
